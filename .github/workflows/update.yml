# .github/workflows/scrape-and-update.yml
name: scrape-and-update

on:
  schedule:
    - cron: '0 8 * * *'     # todos los dÃ­as 08:00 UTC
  workflow_dispatch:        # ejecuciÃ³n manual

permissions:
  contents: write           # para hacer commit/push

jobs:
  run:
    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v4

    - uses: actions/setup-python@v5     # ðŸ‘‰ rueda binaria de lxml disponible
      with:
        python-version: '3.12'          # (o 3.11, pero no 3.13)

    - name: Instalar dependencias
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt

    - name: Ejecutar scrapers
      run: python main.py               # tu orquestador

    - name: Commit cambios CSV
      run: |
        git config user.name  "gh-actions"
        git config user.email "bot@example.com"
        git add files/actualizaciones_expedientes*.csv
        git diff --cached --quiet || \
          (git commit -m "auto: datos $(date -u +'%F %T') [skip ci]" && git push)
